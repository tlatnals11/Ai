<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP ìì¬ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #f0f2f5;
            color: #1a1a1a;
        }

        /* ìƒë‹¨ í—¤ë” */
        .header {
            background: #1a1a2e;
            color: white;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 { font-size: 1.5rem; }
        .header-actions button {
            background: #16213e;
            border: 1px solid #30475e;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 10px;
        }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-container {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e0e0e0;
            padding: 20px 0;
        }

        .menu-item {
            padding: 15px 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #666;
            transition: all 0.2s;
        }

        .menu-item:hover { background: #f5f5f5; }
        .menu-item.active {
            background: #e8f4fd;
            color: #1976d2;
            border-right: 3px solid #1976d2;
        }

        .menu-item span { font-size: 1.1rem; }

        /* ì½˜í…ì¸  ì˜ì—­ */
        .content {
            flex: 1;
            padding: 30px;
        }

        /* í†µê³„ ì¹´ë“œ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #1a1a1a;
        }

        .stat-card.warning .value { color: #f57c00; }
        .stat-card.danger .value { color: #d32f2f; }
        .stat-card.success .value { color: #388e3c; }

        /* í…Œì´ë¸” ê³µí†µ */
        .table-container {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-header h2 { font-size: 1.3rem; }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .btn-primary { background: #1976d2; color: white; }
        .btn-primary:hover { background: #1565c0; }

        .btn-secondary { background: #f5f5f5; color: #333; }
        .btn-secondary:hover { background: #e0e0e0; }

        .btn-danger { background: #d32f2f; color: white; }
        .btn-danger:hover { background: #c62828; }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        th {
            background: #fafafa;
            font-weight: 600;
            color: #555;
            font-size: 0.85rem;
        }

        tr:hover { background: #f9f9f9; }

        /* ìƒíƒœ ë±ƒì§€ */
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success { background: #e8f5e9; color: #2e7d32; }
        .badge-warning { background: #fff3e0; color: #ef6c00; }
        .badge-danger { background: #ffebee; color: #c62828; }
        .badge-info { background: #e3f2fd; color: #1565c0; }

        /* ëª¨ë‹¬ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: white;
            border-radius: 20px;
            width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 { font-size: 1.2rem; }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #888;
        }

        .modal-body { padding: 24px; }

        .form-group { margin-bottom: 16px; }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
            font-family: inherit;
        }

        .form-group input:focus {
            outline: none;
            border-color: #1976d2;
        }

        .form-row {
            display: flex;
            gap: 12px;
        }

        .form-row .form-group { flex: 1; }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #f0f0f0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* ì¬ê³  ë¶€ì¡± ì•„ì´ì½˜ */
        .low-stock {
            color: #f57c00;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        @media (max-width: 1024px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .sidebar { width: 70px; }
            .menu-item span { display: none; }
        }

        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr; }
            .main-container { flex-direction: column; }
            .sidebar { width: 100%; display: flex; overflow-x: auto; }
            .menu-item { flex-shrink: 0; padding: 12px 20px; }
            .menu-item span { display: inline; }
        }
    </style>
</head>
<body>

    <!-- í—¤ë” -->
    <header class="header">
        <h1>ğŸ­ ERP ìì¬ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
        <div class="header-actions">
            <button onclick="initData()">ğŸ”„ ë°ì´í„° ì´ˆê¸°í™”</button>
        </div>
    </header>

    <div class="main-container">
        <!-- ì‚¬ì´ë“œë°” -->
        <nav class="sidebar">
            <div class="menu-item active" data-view="dashboard" onclick="switchView('dashboard')">
                <span>ğŸ“Š</span> ëŒ€ì‹œë³´ë“œ
            </div>
            <div class="menu-item" data-view="materials" onclick="switchView('materials')">
                <span>ğŸ“¦</span> ìì¬ ëª©ë¡
            </div>
            <div class="menu-item" data-view="inbound" onclick="switchView('inbound')">
                <span>ğŸ“¥</span> ì…ê³  ê´€ë¦¬
            </div>
            <div class="menu-item" data-view="outbound" onclick="switchView('outbound')">
                <span>ğŸ“¤</span> ì¶œê³  ê´€ë¦¬
            </div>
            <div class="menu-item" data-view="partners" onclick="switchView('partners')">
                <span>ğŸ¢</span> ê±°ë˜ì²˜ ê´€ë¦¬
            </div>
        </nav>

        <!-- ì½˜í…ì¸  -->
        <main class="content" id="content">
            <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œè§†å›¾ ë Œë”ë§ -->
        </main>
    </div>

    <!-- ëª¨ë‹¬ -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 id="modalTitle">ëª¨ë‹¬</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- í¼ ë Œë”ë§ -->
            </div>
            <div class="modal-footer" id="modalFooter">
                <!-- ë²„íŠ¼ ë Œë”ë§ -->
            </div>
        </div>
    </div>

<script>
    // ==================== ë°ì´í„°ë² ì´ìŠ¤ (localStorage) ====================
    const DB_KEYS = {
        MATERIALS: 'erp_materials',
        INBOUND: 'erp_inbound',
        OUTBOUND: 'erp_outbound',
        PARTNERS: 'erp_partners',
        TRANSACTIONS: 'erp_transactions'
    };

    // ì´ˆê¸° ë°ì´í„° ìƒì„±
    function initData() {
        if (!confirm('ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.')) return;

        const materials = [
            { id: 1, code: 'MAT-001', name: 'ì›ìì¬ A', category: 'ì›ìì¬', unit: 'kg', stock: 150, minStock: 50, price: 10000, partnerId: 1 },
            { id: 2, code: 'MAT-002', name: 'ì›ìì¬ B', category: 'ì›ìì¬', unit: 'kg', stock: 30, minStock: 50, price: 15000, partnerId: 1 },
            { id: 3, code: 'MAT-003', name: 'ë¶€ìì¬ C', category: 'ë¶€ìì¬', unit: 'ea', stock: 500, minStock: 100, price: 500, partnerId: 2 },
            { id: 4, code: 'MAT-004', name: 'ì™„ì œí’ˆ D', category: 'ì™„ì œí’ˆ', unit: 'ea', stock: 80, minStock: 20, price: 50000, partnerId: null },
            { id: 5, code: 'MAT-005', name: 'í¬ì¥ì¬ E', category: 'ë¶€ìì¬', unit: 'roll', stock: 25, minStock: 30, price: 2000, partnerId: 3 }
        ];

        const partners = [
            { id: 1, name: 'í•œêµ­ë¬¼ì‚°', type: 'supplier', contact: '02-1234-5678', address: 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬' },
            { id: 2, name: 'ê¸€ë¡œë²Œí™”í•™', type: 'supplier', contact: '02-2345-6789', address: 'ì„œìš¸ì‹œ ì†¡íŒŒêµ¬' },
            { id: 3, name: 'íŒ¨í‚¤ì§€ëœë“œ', type: 'supplier', contact: '02-3456-7890', address: 'ê²½ê¸°ë„ ì•ˆì‚°ì‹œ' }
        ];

        const transactions = [
            { id: 1, type: 'inbound', materialId: 1, quantity: 100, date: '2025-01-10', partnerId: 1, note: 'êµ¬ë§¤ ì…ê³ ' },
            { id: 2, type: 'outbound', materialId: 4, quantity: 20, date: '2025-01-12', partnerId: null, note: 'íŒë§¤ ì¶œê³ ' }
        ];

        localStorage.setItem(DB_KEYS.MATERIALS, JSON.stringify(materials));
        localStorage.setItem(DB_KEYS.PARTNERS, JSON.stringify(partners));
        localStorage.setItem(DB_KEYS.TRANSACTIONS, JSON.stringify(transactions));

        alert('ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
        renderAll();
    }

    // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    function getData(key) {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : [];
    }

    // ë°ì´í„° ì €ì¥
    function setData(key, data) {
        localStorage.setItem(key, JSON.stringify(data));
    }

    // ==================== ë·° ë Œë”ë§ ====================
    function switchView(viewName) {
        // ë©”ë‰´ í™œì„±í™”
        document.querySelectorAll('.menu-item').forEach(item => {
            item.classList.toggle('active', item.dataset.view === viewName);
        });

        const content = document.getElementById('content');

        switch(viewName) {
            case 'dashboard':
                content.innerHTML = renderDashboard();
                break;
            case 'materials':
                content.innerHTML = renderMaterials();
                break;
            case 'inbound':
                content.innerHTML = renderInbound();
                break;
            case 'outbound':
                content.innerHTML = renderOutbound();
                break;
            case 'partners':
                content.innerHTML = renderPartners();
                break;
        }
    }

    // ëŒ€ì‹œë³´ë“œ
    function renderDashboard() {
        const materials = getData(DB_KEYS.MATERIALS);
        const transactions = getData(DB_KEYS.TRANSACTIONS);

        const totalMaterials = materials.length;
        const lowStock = materials.filter(m => m.stock < m.minStock).length;
        const todayInbound = transactions.filter(t => t.type === 'inbound').length;
        const todayOutbound = transactions.filter(t => t.type === 'outbound').length;

        return `
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>ğŸ“¦ ì´ ìì¬ í’ˆëª©</h3>
                    <div class="value">${totalMaterials}</div>
                </div>
                <div class="stat-card warning">
                    <h3>âš ï¸ ì¬ê³  ë¶€ì¡±</h3>
                    <div class="value">${lowStock}</div>
                </div>
                <div class="stat-card success">
                    <h3>ğŸ“¥ ì˜¤ëŠ˜ ì…ê³ </h3>
                    <div class="value">${todayInbound}</div>
                </div>
                <div class="stat-card danger">
                    <h3>ğŸ“¤ ì˜¤ëŠ˜ ì¶œê³ </h3>
                    <div class="value">${todayOutbound}</div>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <h2>âš ï¸ ì¬ê³  ë¶€ì¡± ìì¬</h2>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ìì¬ì½”ë“œ</th>
                            <th>ìì¬ëª…</th>
                            <th>í˜„ì¬ê³ </th>
                            <th>ìµœì†Œì¬ê³ </th>
                            <th>ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${materials.filter(m => m.stock < m.minStock).map(m => `
                            <tr>
                                <td>${m.code}</td>
                                <td>${m.name}</td>
                                <td><strong>${m.stock}</strong> ${m.unit}</td>
                                <td>${m.minStock} ${m.unit}</td>
                                <td><span class="badge badge-danger">ì¬ê³ ë¶€ì¡±</span></td>
                            </tr>
                        `).join('') || '<tr><td colspan="5" style="text-align:center;color:#888">ì¬ê³  ë¶€ì¡± ìì¬ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>'}
                    </tbody>
                </table>
            </div>
        `;
    }

    // ìì¬ ëª©ë¡
    function renderMaterials() {
        const materials = getData(DB_KEYS.MATERIALS);

        return `
            <div class="table-container">
                <div class="table-header">
                    <h2>ğŸ“¦ ìì¬ ëª©ë¡</h2>
                    <button class="btn btn-primary" onclick="openMaterialModal()">â• ìì¬ ì¶”ê°€</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ìì¬ì½”ë“œ</th>
                            <th>ìì¬ëª…</th>
                            <th>êµ¬ë¶„</th>
                            <th>í˜„ì¬ê³ </th>
                            <th>ë‹¨ê°€</th>
                            <th>ìƒíƒœ</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${materials.map(m => {
                            const isLowStock = m.stock < m.minStock;
                            return `
                                <tr>
                                    <td>${m.code}</td>
                                    <td>${m.name}</td>
                                    <td>${m.category}</td>
                                    <td>${m.stock} ${m.unit}</td>
                                    <td>${m.price.toLocaleString()}ì›</td>
                                    <td>
                                        ${isLowStock
                                            ? '<span class="badge badge-danger">ì¬ê³ ë¶€ì¡±</span>'
                                            : '<span class="badge badge-success">ì •ìƒ</span>'}
                                    </td>
                                    <td>
                                        <button class="btn btn-secondary" style="padding:6px 12px;font-size:0.8rem" onclick="editMaterial(${m.id})">ìˆ˜ì •</button>
                                        <button class="btn btn-danger" style="padding:6px 12px;font-size:0.8rem" onclick="deleteMaterial(${m.id})">ì‚­ì œ</button>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        `;
    }

    // ì…ê³  ê´€ë¦¬
    function renderInbound() {
        const materials = getData(DB_KEYS.MATERIALS);
        const transactions = getData(DB_KEYS.TRANSACTIONS).filter(t => t.type === 'inbound');
        const partners = getData(DB_KEYS.PARTNERS);

        return `
            <div class="table-container">
                <div class="table-header">
                    <h2>ğŸ“¥ ì…ê³  ê´€ë¦¬</h2>
                    <button class="btn btn-primary" onclick="openInboundModal()">â• ì…ê³  ë“±ë¡</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ì…ê³ ì¼</th>
                            <th>ìì¬ëª…</th>
                            <th>ìˆ˜ëŸ‰</th>
                            <th>ê±°ë˜ì²˜</th>
                            <th>ë¹„ê³ </th>
                        </tr>
                    </thead>
                    <tbody>
                        ${transactions.sort((a,b) => b.date.localeCompare(a.date)).map(t => {
                            const material = materials.find(m => m.id === t.materialId);
                            const partner = partners.find(p => p.id === t.partnerId);
                            return `
                                <tr>
                                    <td>${t.date}</td>
                                    <td>${material?.name || '-'}</td>
                                    <td>${t.quantity} ${material?.unit || ''}</td>
                                    <td>${partner?.name || '-'}</td>
                                    <td>${t.note || '-'}</td>
                                </tr>
                            `;
                        }).join('') || '<tr><td colspan="5" style="text-align:center;color:#888">ì…ê³  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>'}
                    </tbody>
                </table>
            </div>
        `;
    }

    // ì¶œê³  ê´€ë¦¬
    function renderOutbound() {
        const materials = getData(DB_KEYS.MATERIALS);
        const transactions = getData(DB_KEYS.TRANSACTIONS).filter(t => t.type === 'outbound');

        return `
            <div class="table-container">
                <div class="table-header">
                    <h2>ğŸ“¤ ì¶œê³  ê´€ë¦¬</h2>
                    <button class="btn btn-primary" onclick="openOutboundModal()">â• ì¶œê³  ë“±ë¡</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ì¶œê³ ì¼</th>
                            <th>ìì¬ëª…</th>
                            <th>ìˆ˜ëŸ‰</th>
                            <th>ë¹„ê³ </th>
                        </tr>
                    </thead>
                    <tbody>
                        ${transactions.sort((a,b) => b.date.localeCompare(a.date)).map(t => {
                            const material = materials.find(m => m.id === t.materialId);
                            return `
                                <tr>
                                    <td>${t.date}</td>
                                    <td>${material?.name || '-'}</td>
                                    <td>${t.quantity} ${material?.unit || ''}</td>
                                    <td>${t.note || '-'}</td>
                                </tr>
                            `;
                        }).join('') || '<tr><td colspan="4" style="text-align:center;color:#888">ì¶œê³  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>'}
                    </tbody>
                </table>
            </div>
        `;
    }

    // ê±°ë˜ì²˜ ê´€ë¦¬
    function renderPartners() {
        const partners = getData(DB_KEYS.PARTNERS);

        return `
            <div class="table-container">
                <div class="table-header">
                    <h2>ğŸ¢ ê±°ë˜ì²˜ ëª©ë¡</h2>
                    <button class="btn btn-primary" onclick="openPartnerModal()">â• ê±°ë˜ì²˜ ì¶”ê°€</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ê±°ë˜ì²˜ì½”ë“œ</th>
                            <th>ê±°ë˜ì²˜ëª…</th>
                            <th>ìœ í˜•</th>
                            <th>ì—°ë½ì²˜</th>
                            <th>ì£¼ì†Œ</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${partners.map(p => `
                            <tr>
                                <td>PTN-${String(p.id).padStart(3, '0')}</td>
                                <td>${p.name}</td>
                                <td><span class="badge badge-info">${p.type === 'supplier' ? 'ê³µê¸‰ì—…ì²´' : 'ê³ ê°'}</span></td>
                                <td>${p.contact}</td>
                                <td>${p.address}</td>
                                <td>
                                    <button class="btn btn-danger" style="padding:6px 12px;font-size:0.8rem" onclick="deletePartner(${p.id})">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
    }

    // ==================== ëª¨ë‹¬ ====================
    function openModal(title, bodyHtml, footerHtml) {
        document.getElementById('modalTitle').textContent = title;
        document.getElementById('modalBody').innerHTML = bodyHtml;
        document.getElementById('modalFooter').innerHTML = footerHtml;
        document.getElementById('modalOverlay').classList.add('show');
    }

    function closeModal(e) {
        if (!e || e.target === document.getElementById('modalOverlay')) {
            document.getElementById('modalOverlay').classList.remove('show');
        }
    }

    // ìì¬ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬
    function openMaterialModal(id = null) {
        const materials = getData(DB_KEYS.MATERIALS);
        const material = id ? materials.find(m => m.id === id) : null;

        const title = id ? 'âœï¸ ìì¬ ìˆ˜ì •' : 'â• ìì¬ ì¶”ê°€';
        const partners = getData(DB_KEYS.PARTNERS);

        const body = `
            <form id="materialForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>ìì¬ì½”ë“œ</label>
                        <input type="text" name="code" value="${material?.code || ''}" ${material ? 'readonly' : ''} required>
                    </div>
                    <div class="form-group">
                        <label>êµ¬ë¶„</label>
                        <select name="category" required>
                            <option value="ì›ìì¬" ${material?.category === 'ì›ìì¬' ? 'selected' : ''}>ì›ìì¬</option>
                            <option value="ë¶€ìì¬" ${material?.category === 'ë¶€ìì¬' ? 'selected' : ''}>ë¶€ìì¬</option>
                            <option value="ì™„ì œí’ˆ" ${material?.category === 'ì™„ì œí’ˆ' ? 'selected' : ''}>ì™„ì œí’ˆ</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>ìì¬ëª…</label>
                    <input type="text" name="name" value="${material?.name || ''}" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>í˜„ì¬ê³ </label>
                        <input type="number" name="stock" value="${material?.stock || 0}" required>
                    </div>
                    <div class="form-group">
                        <label>ë‹¨ìœ„</label>
                        <select name="unit" required>
                            <option value="kg" ${material?.unit === 'kg' ? 'selected' : ''}>kg</option>
                            <option value="ea" ${material?.unit === 'ea' ? 'selected' : ''}>ê°œ</option>
                            <option value="roll" ${material?.unit === 'roll' ? 'selected' : ''}>ë¡¤</option>
                            <option value="box" ${material?.unit === 'box' ? 'selected' : ''}>ë°•ìŠ¤</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ìµœì†Œì¬ê³ </label>
                        <input type="number" name="minStock" value="${material?.minStock || 0}" required>
                    </div>
                    <div class="form-group">
                        <label>ë‹¨ê°€</label>
                        <input type="number" name="price" value="${material?.price || 0}" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>ê±°ë˜ì²˜</label>
                    <select name="partnerId">
                        <option value="">ì—†ìŒ</option>
                        ${partners.map(p => `<option value="${p.id}" ${material?.partnerId === p.id ? 'selected' : ''}>${p.name}</option>`).join('')}
                    </select>
                </div>
            </form>
        `;

        const footer = `
            <button class="btn btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
            <button class="btn btn-primary" onclick="saveMaterial(${id})">${id ? 'ìˆ˜ì •' : 'ì €ì¥'}</button>
        `;

        openModal(title, body, footer);
    }

    function saveMaterial(id) {
        const form = document.getElementById('materialForm');
        const formData = new FormData(form);

        const material = {
            code: formData.get('code'),
            name: formData.get('name'),
            category: formData.get('category'),
            unit: formData.get('unit'),
            stock: parseInt(formData.get('stock')),
            minStock: parseInt(formData.get('minStock')),
            price: parseInt(formData.get('price')),
            partnerId: formData.get('partnerId') ? parseInt(formData.get('partnerId')) : null
        };

        const materials = getData(DB_KEYS.MATERIALS);

        if (id) {
            // ìˆ˜ì •
            const index = materials.findIndex(m => m.id === id);
            if (index !== -1) {
                materials[index] = { ...materials[index], ...material };
            }
        } else {
            // ì¶”ê°€
            material.id = Date.now();
            materials.push(material);
        }

        setData(DB_KEYS.MATERIALS, materials);
        closeModal();
        switchView('materials');
    }

    function editMaterial(id) {
        openMaterialModal(id);
    }

    function deleteMaterial(id) {
        if (!confirm('ìì¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        let materials = getData(DB_KEYS.MATERIALS);
        materials = materials.filter(m => m.id !== id);
        setData(DB_KEYS.MATERIALS, materials);
        switchView('materials');
    }

    // ì…ê³  ëª¨ë‹¬
    function openInboundModal() {
        const materials = getData(DB_KEYS.MATERIALS);
        const partners = getData(DB_KEYS.PARTNERS);

        const body = `
            <form id="inboundForm">
                <div class="form-group">
                    <label>ìì¬</label>
                    <select name="materialId" required>
                        ${materials.map(m => `<option value="${m.id}">${m.name} (${m.stock} ${m.unit})</option>`).join('')}
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ìˆ˜ëŸ‰</label>
                        <input type="number" name="quantity" min="1" required>
                    </div>
                    <div class="form-group">
                        <label>ì…ê³ ì¼</label>
                        <input type="date" name="date" value="${new Date().toISOString().split('T')[0]}" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>ê±°ë˜ì²˜</label>
                    <select name="partnerId" required>
                        ${partners.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label>ë¹„ê³ </label>
                    <input type="text" name="note" placeholder="ì…ê³  ê´€ë ¨ ë©”ëª¨">
                </div>
            </form>
        `;

        const footer = `
            <button class="btn btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
            <button class="btn btn-primary" onclick="saveInbound()">ì…ê³  ë“±ë¡</button>
        `;

        openModal('ğŸ“¥ ì…ê³  ë“±ë¡', body, footer);
    }

    function saveInbound() {
        const form = document.getElementById('inboundForm');
        const formData = new FormData(form);

        const materialId = parseInt(formData.get('materialId'));
        const quantity = parseInt(formData.get('quantity'));
        const partnerId = parseInt(formData.get('partnerId'));

        // ìì¬ ì¬ê³  ì¦ê°€
        const materials = getData(DB_KEYS.MATERIALS);
        const materialIndex = materials.findIndex(m => m.id === materialId);

        if (materialIndex !== -1) {
            materials[materialIndex].stock += quantity;
            setData(DB_KEYS.MATERIALS, materials);
        }

        // ê±°ë˜ ë‚´ì—­ ì €ì¥
        const transactions = getData(DB_KEYS.TRANSACTIONS);
        transactions.push({
            id: Date.now(),
            type: 'inbound',
            materialId,
            quantity,
            date: formData.get('date'),
            partnerId,
            note: formData.get('note')
        });
        setData(DB_KEYS.TRANSACTIONS, transactions);

        closeModal();
        switchView('inbound');
    }

    // ì¶œê³  ëª¨ë‹¬
    function openOutboundModal() {
        const materials = getData(DB_KEYS.MATERIALS);

        const body = `
            <form id="outboundForm">
                <div class="form-group">
                    <label>ìì¬</label>
                    <select name="materialId" required onchange="checkStock(this)">
                        ${materials.map(m => `<option value="${m.id}" data-stock="${m.stock}">${m.name} (${m.stock} ${m.unit})</option>`).join('')}
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ìˆ˜ëŸ‰</label>
                        <input type="number" name="quantity" min="1" required>
                    </div>
                    <div class="form-group">
                        <label>ì¶œê³ ì¼</label>
                        <input type="date" name="date" value="${new Date().toISOString().split('T')[0]}" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>ë¹„ê³ </label>
                    <input type="text" name="note" placeholder="ì¶œê³  ê´€ë ¨ ë©”ëª¨">
                </div>
            </form>
        `;

        const footer = `
            <button class="btn btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
            <button class="btn btn-primary" onclick="saveOutbound()">ì¶œê³  ë“±ë¡</button>
        `;

        openModal('ğŸ“¤ ì¶œê³  ë“±ë¡', body, footer);
    }

    function checkStock(select) {
        const option = select.options[select.selectedIndex];
        const maxStock = parseInt(option.dataset.stock);
        const quantityInput = document.querySelector('input[name="quantity"]');
        quantityInput.max = maxStock;
    }

    function saveOutbound() {
        const form = document.getElementById('outboundForm');
        const formData = new FormData(form);

        const materialId = parseInt(formData.get('materialId'));
        const quantity = parseInt(formData.get('quantity'));

        // ì¬ê³  í™•ì¸
        const materials = getData(DB_KEYS.MATERIALS);
        const material = materials.find(m => m.id === materialId);

        if (material.stock < quantity) {
            alert(`ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. (í˜„ì¬ê³ : ${material.stock} ${material.unit})`);
            return;
        }

        // ìì¬ ì¬ê³  ê°ì†Œ
        const materialIndex = materials.findIndex(m => m.id === materialId);
        if (materialIndex !== -1) {
            materials[materialIndex].stock -= quantity;
            setData(DB_KEYS.MATERIALS, materials);
        }

        // ê±°ë˜ ë‚´ì—­ ì €ì¥
        const transactions = getData(DB_KEYS.TRANSACTIONS);
        transactions.push({
            id: Date.now(),
            type: 'outbound',
            materialId,
            quantity,
            date: formData.get('date'),
            partnerId: null,
            note: formData.get('note')
        });
        setData(DB_KEYS.TRANSACTIONS, transactions);

        closeModal();
        switchView('outbound');
    }

    // ê±°ë˜ì²˜ ì¶”ê°€
    function openPartnerModal() {
        const body = `
            <form id="partnerForm">
                <div class="form-group">
                    <label>ê±°ë˜ì²˜ëª…</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>ìœ í˜•</label>
                    <select name="type" required>
                        <option value="supplier">ê³µê¸‰ì—…ì²´</option>
                        <option value="customer">ê³ ê°</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì—°ë½ì²˜</label>
                    <input type="text" name="contact" required>
                </div>
                <div class="form-group">
                    <label>ì£¼ì†Œ</label>
                    <input type="text" name="address" required>
                </div>
            </form>
        `;

        const footer = `
            <button class="btn btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
            <button class="btn btn-primary" onclick="savePartner()">ì €ì¥</button>
        `;

        openModal('ğŸ¢ ê±°ë˜ì²˜ ì¶”ê°€', body, footer);
    }

    function savePartner() {
        const form = document.getElementById('partnerForm');
        const formData = new FormData(form);

        const partners = getData(DB_KEYS.PARTNERS);

        partners.push({
            id: Date.now(),
            name: formData.get('name'),
            type: formData.get('type'),
            contact: formData.get('contact'),
            address: formData.get('address')
        });

        setData(DB_KEYS.PARTNERS, partners);
        closeModal();
        switchView('partners');
    }

    function deletePartner(id) {
        if (!confirm('ê±°ë˜ì²˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        let partners = getData(DB_KEYS.PARTNERS);
        partners = partners.filter(p => p.id !== id);
        setData(DB_KEYS.PARTNERS, partners);
        switchView('partners');
    }

    function renderAll() {
        switchView('dashboard');
    }

    // ì´ˆê¸°í™”
    if (!localStorage.getItem(DB_KEYS.MATERIALS)) {
        initData();
    } else {
        renderAll();
    }
</script>

</body>
</html>