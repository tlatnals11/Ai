<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100 Days Challenge</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
    <style>
        :root {
            --theme-color: #4a90e2;
            --bg-color: #f0f2f5;
            --cell-bg: #ffffff;
            --text-color: #333;
            --font-style: 'Noto Sans KR', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-style);
            min-height: 100vh;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
            max-width: 800px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { font-size: 2rem; color: var(--theme-color); }

        .progress-box {
            font-size: 1rem;
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .settings-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #888;
        }

        /* ì„¤ì • íŒ¨ë„ */
        .settings-panel {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            width: 100%;
            max-width: 800px;
            flex-direction: column;
            gap: 15px;
        }
        .settings-panel.active { display: flex; }

        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .setting-row:last-child { border-bottom: none; }

        .setting-label { font-weight: bold; color: #555; }

        input[type="color"] { border: none; width: 40px; height: 40px; cursor: pointer; }

        select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        /* ê¸°ë³¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜ì—­ */
        .default-img-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .default-preview {
            width: 50px; height: 50px;
            object-fit: cover;
            border-radius: 5px;
            border: 2px solid #ddd;
            display: none;
        }

        .btn-upload {
            padding: 8px 15px;
            background: #eee;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .btn-reset {
            padding: 8px 15px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            display: none; /* ê¸°ë³¸ ì´ë¯¸ì§€ê°€ ìˆì„ ë•Œë§Œ í‘œì‹œ */
        }

        /* 100ì¼ ê·¸ë¦¬ë“œ */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 800px;
        }

        .day-cell {
            aspect-ratio: 1 / 1;
            background: var(--cell-bg);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            font-weight: bold;
            color: var(--text-color);
            overflow: hidden;
        }

        .day-cell:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid var(--theme-color);
        }

        .day-cell.completed {
            background-color: var(--theme-color);
            color: white;
        }

        .stamp-img {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.8;
            z-index: 1;
        }

        .day-number {
            z-index: 2;
            font-size: 1.2rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 350px;
            text-align: center;
        }

        .modal h2 { color: var(--theme-color); margin-bottom: 20px; }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .file-upload-label {
            display: block;
            padding: 15px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 15px;
            color: #777;
        }

        #previewImg {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid var(--theme-color);
            margin: 0 auto 15px;
            display: none;
        }

        .btn-group { display: flex; gap: 10px; justify-content: center; }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-save { background: var(--theme-color); color: white; }
        .btn-delete { background: #ff6b6b; color: white; }
        .btn-cancel { background: #eee; color: #555; }

    </style>
</head>
<body>

    <div class="header">
        <h1>ğŸ† 100 Days Challenge</h1>
        <button class="settings-btn" id="settingsBtn">âš™ï¸</button>
    </div>

    <!-- ì„¤ì • íŒ¨ë„ -->
    <div class="settings-panel" id="settingsPanel">
        <!-- í…Œë§ˆ ì„¤ì • -->
        <div class="setting-row">
            <span class="setting-label">í…Œë§ˆ ìƒ‰ìƒ</span>
            <input type="color" id="themeColorInput" value="#4a90e2">
        </div>
        <div class="setting-row">
            <span class="setting-label">ë°°ê²½ ìƒ‰ìƒ</span>
            <input type="color" id="bgColorInput" value="#f0f2f5">
        </div>
        <div class="setting-row">
            <span class="setting-label">ê¸€ê¼´ ìŠ¤íƒ€ì¼</span>
            <select id="fontStyleInput">
                <option value="'Noto Sans KR', sans-serif">ëª¨ë˜</option>
                <option value="'Nanum Pen Script', cursive">ì†ê¸€ì”¨</option>
            </select>
        </div>

        <!-- ê¸°ë³¸ ì´ë¯¸ì§€ ì„¤ì • -->
        <div class="setting-row">
            <div class="setting-label">ê¸°ë³¸ ì´ë¯¸ì§€ (ì „ì²´ ì ìš©)</div>
            <div class="default-img-section">
                <img id="defaultImgPreview" class="default-preview" src="">
                <label for="defaultImgInput" class="btn-upload">ğŸ“ ì´ë¯¸ì§€ ì„ íƒ</label>
                <input type="file" id="defaultImgInput" accept="image/*" style="display:none;">
                <button id="resetDefaultImgBtn" class="btn-reset">ê¸°ë³¸ ì´ë¯¸ì§€ ì‚­ì œ</button>
            </div>
        </div>
    </div>

    <div class="progress-box" id="progressBox">
        ì§„í–‰ë¥ : 0 / 100
    </div>

    <br>

    <div class="grid-container" id="gridContainer"></div>

    <!-- ëª¨ë‹¬ -->
    <div class="modal" id="dataModal">
        <div class="modal-content">
            <h2 id="modalTitle">Day 1</h2>
            <input type="text" id="textInput" placeholder="ì˜¤ëŠ˜ì˜ í•œ ë§ˆë”” (ì„ íƒ)">

            <label for="fileInput" class="file-upload-label">
                ğŸ“· ê°œë³„ ì‚¬ì§„ ë³€ê²½ (ì„ íƒ)
            </label>
            <input type="file" id="fileInput" accept="image/*" style="display:none;">

            <img id="previewImg" src="">

            <div style="font-size: 0.8rem; color: #888; margin-bottom: 15px;">
                * ë¹„ì›Œë‘ë©´ ê¸°ë³¸ ì´ë¯¸ì§€ê°€ ì ìš©ë©ë‹ˆë‹¤.
            </div>

            <div class="btn-group">
                <button class="btn btn-delete" id="deleteBtn">ì´ˆê¸°í™”</button>
                <button class="btn btn-cancel" id="cancelBtn">ì·¨ì†Œ</button>
                <button class="btn btn-save" id="saveBtn">ì €ì¥</button>
            </div>
        </div>
    </div>

<script>
    let selectedDay = null;

    const gridContainer = document.getElementById('gridContainer');
    const modal = document.getElementById('dataModal');
    const fileInput = document.getElementById('fileInput');
    const previewImg = document.getElementById('previewImg');
    const progressBox = document.getElementById('progressBox');

    // ì„¤ì • ìš”ì†Œ
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsPanel = document.getElementById('settingsPanel');
    const themeColorInput = document.getElementById('themeColorInput');
    const bgColorInput = document.getElementById('bgColorInput');
    const fontStyleInput = document.getElementById('fontStyleInput');
    const defaultImgInput = document.getElementById('defaultImgInput');
    const defaultImgPreview = document.getElementById('defaultImgPreview');
    const resetDefaultImgBtn = document.getElementById('resetDefaultImgBtn');

    // 1. ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
        loadThemeSettings();
        loadDefaultImage();
        renderGrid();
        updateProgress();
    });

    // 2. í…Œë§ˆ ì„¤ì •
    function loadThemeSettings() {
        const savedTheme = localStorage.getItem('challengeThemeColor') || '#4a90e2';
        const savedBg = localStorage.getItem('challengeBgColor') || '#f0f2f5';
        const savedFont = localStorage.getItem('challengeFontStyle') || "'Noto Sans KR', sans-serif";

        document.documentElement.style.setProperty('--theme-color', savedTheme);
        document.documentElement.style.setProperty('--bg-color', savedBg);
        document.documentElement.style.setProperty('--font-style', savedFont);

        themeColorInput.value = savedTheme;
        bgColorInput.value = savedBg;
        fontStyleInput.value = savedFont;
    }

    themeColorInput.addEventListener('input', (e) => {
        document.documentElement.style.setProperty('--theme-color', e.target.value);
        localStorage.setItem('challengeThemeColor', e.target.value);
    });

    bgColorInput.addEventListener('input', (e) => {
        document.documentElement.style.setProperty('--bg-color', e.target.value);
        localStorage.setItem('challengeBgColor', e.target.value);
    });

    fontStyleInput.addEventListener('change', (e) => {
        document.documentElement.style.setProperty('--font-style', e.target.value);
        localStorage.setItem('challengeFontStyle', e.target.value);
    });

    settingsBtn.addEventListener('click', () => {
        settingsPanel.classList.toggle('active');
    });

    // 3. ê¸°ë³¸ ì´ë¯¸ì§€ ì„¤ì • ê¸°ëŠ¥
    function loadDefaultImage() {
        const defaultImg = localStorage.getItem('defaultChallengeImage');
        if(defaultImg) {
            defaultImgPreview.src = defaultImg;
            defaultImgPreview.style.display = 'block';
            resetDefaultImgBtn.style.display = 'inline-block';
        }
    }

    // ê¸°ë³¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ
    defaultImgInput.addEventListener('change', function() {
        if(this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const imgData = e.target.result;
                localStorage.setItem('defaultChallengeImage', imgData);
                defaultImgPreview.src = imgData;
                defaultImgPreview.style.display = 'block';
                resetDefaultImgBtn.style.display = 'inline-block';
                renderGrid(); // ê·¸ë¦¬ë“œ ìƒˆë¡œê³ ì¹¨
            };
            reader.readAsDataURL(this.files[0]);
        }
    });

    // ê¸°ë³¸ ì´ë¯¸ì§€ ì‚­ì œ
    resetDefaultImgBtn.addEventListener('click', () => {
        if(confirm("ê¸°ë³¸ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ë‚ ì§œì˜ ì´ë¯¸ì§€ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.")) {
            localStorage.removeItem('defaultChallengeImage');
            defaultImgPreview.src = '';
            defaultImgPreview.style.display = 'none';
            resetDefaultImgBtn.style.display = 'none';
            renderGrid();
        }
    });

    // 4. ê·¸ë¦¬ë“œ ë Œë”ë§
    function renderGrid() {
        gridContainer.innerHTML = "";
        const defaultImg = localStorage.getItem('defaultChallengeImage');

        for(let i=1; i<=100; i++) {
            const cell = document.createElement('div');
            cell.className = 'day-cell';

            const dayNum = document.createElement('span');
            dayNum.className = 'day-number';
            dayNum.innerText = i;
            cell.appendChild(dayNum);

            const savedData = localStorage.getItem(`day_${i}`);
            let hasData = false;

            if(savedData) {
                const data = JSON.parse(savedData);
                if(data.text || data.image) {
                    cell.classList.add('completed');
                    hasData = true;
                }

                // ê°œë³„ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ ì´ë¯¸ì§€ ì‚¬ìš©
                const displayImg = data.image || defaultImg;

                if(displayImg) {
                    const img = document.createElement('img');
                    img.src = displayImg;
                    img.className = 'stamp-img';
                    cell.appendChild(img);
                }
            } else if (defaultImg) {
                // ì €ì¥ëœ ë°ì´í„°ëŠ” ì—†ì§€ë§Œ ê¸°ë³¸ ì´ë¯¸ì§€ê°€ ìˆì„ ê²½ìš°
                // (completed í´ë˜ìŠ¤ëŠ” ë¹¼ê³  ì´ë¯¸ì§€ë§Œ í‘œì‹œ)
                const img = document.createElement('img');
                img.src = defaultImg;
                img.className = 'stamp-img';
                cell.appendChild(img);
            }

            cell.addEventListener('click', () => openModal(i));
            gridContainer.appendChild(cell);
        }
    }

    // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
    function updateProgress() {
        let count = 0;
        for(let i=1; i<=100; i++) {
            const data = localStorage.getItem(`day_${i}`);
            if(data) {
                const parsed = JSON.parse(data);
                if(parsed.text || parsed.image) count++;
            }
        }
        progressBox.innerText = `ì§„í–‰ë¥ : ${count} / 100`;
    }

    // 5. ëª¨ë‹¬
    function openModal(day) {
        selectedDay = day;
        document.getElementById('modalTitle').innerText = `Day ${day}`;

        document.getElementById('textInput').value = '';
        fileInput.value = '';
        previewImg.style.display = 'none';

        const saved = localStorage.getItem(`day_${day}`);
        if(saved) {
            const data = JSON.parse(saved);
            if(data.text) document.getElementById('textInput').value = data.text;
            if(data.image) {
                previewImg.src = data.image;
                previewImg.style.display = 'block';
            }
        }

        modal.style.display = 'flex';
    }

    fileInput.addEventListener('change', function() {
        if(this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImg.src = e.target.result;
                previewImg.style.display = 'block';
            };
            reader.readAsDataURL(this.files[0]);
        }
    });

    // ì €ì¥ ë²„íŠ¼
    document.getElementById('saveBtn').addEventListener('click', () => {
        const text = document.getElementById('textInput').value;
        const newImage = previewImg.style.display !== 'none' && previewImg.src.startsWith('data:') ? previewImg.src : null;

        const existing = localStorage.getItem(`day_${selectedDay}`) ? JSON.parse(localStorage.getItem(`day_${selectedDay}`)) : {};

        // ìƒˆ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ìƒˆ ì´ë¯¸ì§€, ì—†ìœ¼ë©´ ê¸°ì¡´ ë°ì´í„° ìœ ì§€
        const finalImage = newImage || existing.image || null;

        // í…ìŠ¤íŠ¸ë‚˜ ì´ë¯¸ì§€ê°€ ìˆì„ ë•Œë§Œ ì €ì¥ (ë¹ˆ ê°’ì€ ì €ì¥ ì•ˆ í•¨)
        if(!text && !finalImage) {
            // ê·¸ëƒ¥ ë‹«ê¸°
            modal.style.display = 'none';
            return;
        }

        const data = { text: text, image: finalImage };

        try {
            localStorage.setItem(`day_${selectedDay}`, JSON.stringify(data));
            modal.style.display = 'none';
            renderGrid();
            updateProgress();
        } catch(e) {
            alert("ì €ì¥ ì‹¤íŒ¨: ì´ë¯¸ì§€ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤.");
        }
    });

    // ì´ˆê¸°í™” (ì‚­ì œ) ë²„íŠ¼
    document.getElementById('deleteBtn').addEventListener('click', () => {
        if(confirm("ì´ ë‚ ì§œë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            localStorage.removeItem(`day_${selectedDay}`);
            modal.style.display = 'none';
            renderGrid();
            updateProgress();
        }
    });

    document.getElementById('cancelBtn').addEventListener('click', () => modal.style.display = 'none');
    window.addEventListener('click', (e) => { if(e.target === modal) modal.style.display = 'none'; });

</script>
</body>
</html>