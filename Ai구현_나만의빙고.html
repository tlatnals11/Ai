<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ ì»¤í”Œ ë¹™ê³  ë§Œë“¤ê¸°</title>

    <!-- í°íŠ¸ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #ff6b81;
            --secondary: #ffa07a;
            --bg: #fff5f8;
            --text: #4a3b40;
            --shadow: 0 10px 25px rgba(255, 107, 129, 0.2);
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg);
            background-image: radial-gradient(#ffe0e6 20%, transparent 20%), radial-gradient(#ffe0e6 20%, transparent 20%);
            background-position: 0 0, 25px 25px;
            background-size: 50px 50px;
            color: var(--text);
            margin: 0;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 {
            font-family: 'Nanum Pen Script', cursive;
            font-size: 3.5rem;
            color: var(--primary);
            margin: 10px 0 30px;
            text-shadow: 3px 3px 0px #fff;
            letter-spacing: 3px;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 600px;
            gap: 30px;
        }

        /* ê³µí†µ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .section-box {
            background: #fff;
            padding: 30px;
            border-radius: 30px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 500px;
            text-align: center;
            border: 4px solid #fff0f3;
            animation: popUp 0.5s ease;
        }

        @keyframes popUp {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* ì…ë ¥ ì˜ì—­ */
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        input[type="text"] {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #ffd1d7;
            border-radius: 50px;
            font-size: 1.1rem;
            outline: none;
            transition: 0.3s;
        }

        input[type="text"]:focus {
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(255, 107, 129, 0.2);
        }

        button.add-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        button.add-btn:hover {
            transform: scale(1.05);
            background: #ff4757;
        }

        /* ë“œë˜ê·¸ ê°€ëŠ¥í•œ ëª©ë¡ ìŠ¤íƒ€ì¼ */
        #itemList {
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
            text-align: left;
            min-height: 50px;
        }

        .list-item {
            background: #fff0f3;
            border: 1px solid #ffd1d7;
            margin-bottom: 8px;
            padding: 12px 20px;
            border-radius: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: grab;
            transition: transform 0.2s, background-color 0.2s;
            font-size: 1.1rem;
            user-select: none;
        }

        .list-item:active {
            cursor: grabbing;
            background: #ffe0e6;
            transform: scale(1.02);
        }

        .sortable-ghost { opacity: 0.4; background: #ffd1d7; }
        .sortable-drag { background: #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        .delete-item {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 1.2rem;
            cursor: pointer;
            margin-left: 10px;
            padding: 0 5px;
        }

        .count-badge {
            background: var(--primary);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            margin-right: 12px;
            font-weight: bold;
            display: inline-block;
            min-width: 25px;
        }

        .guide-text {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 15px;
        }

        /* ë§Œë“¤ê¸° ë²„íŠ¼ */
        .make-btn {
            background: linear-gradient(45deg, #ff6b81, #ff9eb5);
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(255, 107, 129, 0.4);
            transition: 0.3s;
            font-family: 'Nanum Pen Script', cursive;
            width: 100%;
        }

        .make-btn:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 25px rgba(255, 107, 129, 0.5);
        }

        .make-btn:disabled {
            background: #ddd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ ì„¹ì…˜ */
        .custom-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .custom-cell {
            background: #fff0f3;
            border: 2px dashed #ffd1d7;
            border-radius: 15px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 110px;
        }

        .custom-emoji-btn {
            font-size: 2rem;
            cursor: pointer;
            margin-bottom: 5px;
            transition: transform 0.2s;
            background: none;
            border: none;
            padding: 0;
        }

        .custom-emoji-btn:hover { transform: scale(1.2); }

        .custom-input {
            width: 100%;
            padding: 5px;
            border: 1px solid #ffd1d7;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-family: 'Noto Sans KR', sans-serif;
            word-break: break-word; /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ í—ˆìš© */
        }

        .custom-input:focus { border-color: var(--primary); outline: none; }

        .custom-title {
            font-family: 'Nanum Pen Script', cursive;
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        /* =========================================
           ê²°ê³¼ ë¹™ê³ íŒ - ìˆ˜ì •ëœ í•µì‹¬ ìŠ¤íƒ€ì¼
           ========================================= */
        .bingo-wrapper {
            display: none;
            flex-direction: column;
            align-items: center;
            animation: popUp 0.5s ease;
            gap: 20px;
        }

        .bingo-board {
            background: #fff;
            padding: 20px;
            border-radius: 30px;
            box-shadow: var(--shadow);
            border: 8px solid #fff0f3;
            position: relative;
            width: 100%;
            max-width: 450px;
        }

        .bingo-board::before {
            content: "ğŸ’•";
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3rem;
        }

        .bingo-title {
            font-family: 'Nanum Pen Script', cursive;
            font-size: 2.5rem;
            color: var(--primary);
            text-align: center;
            margin-bottom: 20px;
        }

        table {
            border-collapse: separate;
            border-spacing: 6px;
            width: 100%;
            margin: 0 auto;
            background: #fff5f8;
            padding: 5px;
            border-radius: 20px;
        }

        td {
            /*aspect-ratio: 1;  ì‚­ì œ: ê³ ì • ë¹„ìœ¨ ëŒ€ì‹  ìœ ë™ì  ë†’ì´ í—ˆìš©*/
            min-height: 90px; /* ìµœì†Œ ë†’ì´ ì„¤ì • */
            text-align: center;
            vertical-align: middle;
            font-weight: bold;
            /* í™”ë©´ ë„ˆë¹„ì— ë”°ë¼ ê¸€ì í¬ê¸° ìœ ë™ ì¡°ì ˆ (ìµœì†Œ 0.7rem, ìµœëŒ€ 1.2rem) */
            font-size: clamp(0.75rem, 2.5vw, 1.2rem);
            padding: 8px;

            /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ í•µì‹¬ ì†ì„± */
            word-break: break-word;
            overflow-wrap: break-word;
            white-space: normal;

            background: #fff;
            border-radius: 12px;
            border: 2px dashed #ffd1d7;
            box-shadow: 2px 2px 0px #fff0f3;
            position: relative;
        }

        /* í…ìŠ¤íŠ¸ê°€ 2ì¤„ ì´ìƒì¼ ë•Œ ì´ëª¨ì§€ í¬ê¸° ì¶•ì†Œ */
        .cell-emoji {
            display: block;
            font-size: clamp(1.2rem, 4vw, 1.8rem); /* ì´ëª¨ì§€ë„ ìœ ë™ í¬ê¸° */
            margin-bottom: 3px;
        }

        /* ë¹ˆì¹¸ ìŠ¤íƒ€ì¼ */
        .empty-cell {
            color: #ccc;
            font-size: 0.8rem;
        }

        /* ì €ì¥ ë²„íŠ¼ */
        .save-btn {
            background: #2ed573;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(46, 213, 115, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .save-btn:hover { background: #26af61; }

    </style>
</head>
<body>

    <h1>ë‚˜ë§Œì˜ Love Bingo ğŸ’˜</h1>

    <div class="container">

        <!-- 1ë‹¨ê³„: ì…ë ¥ ì˜ì—­ -->
        <div class="section-box" id="inputSection">
            <div class="input-group">
                <input type="text" id="todoInput" placeholder="together í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" onkeypress="if(event.key === 'Enter') addItem()">
                <button class="add-btn" onclick="addItem()">â•</button>
            </div>

            <p class="guide-text">
                ğŸ”„ ìˆœì„œë¥¼ ì¡°ì •í•˜ê³  ì‹¶ìœ¼ë©´ ë“œë˜ê·¸í•˜ì„¸ìš”! (ìµœëŒ€ 9ê°œ)
            </p>

            <ul id="itemList"></ul>

            <button class="make-btn" id="makeBtn" onclick="goToCustomize()">ğŸ¨ ë¹™ê³ íŒ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ í•˜ëŸ¬ê°€ê¸°</button>
        </div>

        <!-- 2ë‹¨ê³„: ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ -->
        <div class="section-box" id="customizeSection" style="display: none;">
            <div class="custom-title">âœï¸ ë¹™ê³ íŒ ìˆ˜ì •í•˜ê¸°</div>
            <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">
                ì´ëª¨í‹°ì½˜ì„ í´ë¦­í•˜ì—¬ ë³€ê²½í•˜ê³ , ê¸€ìë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ì„¸ìš”!<br>
                (ê°€ìš´ë° ì¹¸ë„ ììœ ë¡­ê²Œ ì‘ì„± ê°€ëŠ¥í•©ë‹ˆë‹¤)
            </p>

            <div class="custom-grid" id="customGrid">
                <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>

            <div class="nav-buttons">
                <button class="add-btn" style="background-color: #999;" onclick="showInputList()">â¬…ï¸ ëª©ë¡ìˆ˜ë¡œ ëŒì•„ê°€ê¸°</button>
                <button class="make-btn" onclick="generateFinalBingo()">ğŸ‰ ë¹™ê³ íŒ ì™„ì„±í•˜ê¸°</button>
            </div>
        </div>

        <!-- 3ë‹¨ê³„: ê²°ê³¼ ë¹™ê³ íŒ -->
        <div class="bingo-wrapper" id="bingoWrapper">
            <div class="bingo-board" id="captureArea">
                <div class="bingo-title">ğŸ’˜ ë‚˜ë§Œì˜ ë¹™ê³  ğŸ’˜</div>
                <table id="bingoTable">
                    <tr>
                        <td>1</td><td>2</td><td>3</td>
                    </tr>
                    <tr>
                        <td>4</td><td>5</td><td>6</td>
                    </tr>
                    <tr>
                        <td>7</td><td>8</td><td>9</td>
                    </tr>
                </table>
            </div>

            <div class="nav-buttons">
                <button class="add-btn" style="background-color: #ff9eb5;" onclick="goBackToCustomize()">âœï¸ ë‹¤ì‹œ ìˆ˜ì •í•˜ê¸°</button>
                <button class="save-btn" onclick="downloadImage()">
                    ğŸ“¥ ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ê¸°
                </button>
            </div>
        </div>

    </div>

<script>
    // ë°ì´í„° ë° ì„¤ì •
    let items = [];
    const EMOJI_LIST = ['â¤ï¸','ğŸ§¡','ğŸ’›','ğŸ’š','ğŸ’™','ğŸ’œ','ğŸ–¤','ğŸ¤','ğŸ¤','ğŸ’•','ğŸ’','ğŸ’“','ğŸ’—','ğŸ’–','ğŸ’˜','ğŸ’','ğŸ','ğŸ€','ğŸ„','ğŸ‚','ğŸˆ','ğŸ‰','ğŸ','ğŸ','ğŸ‘','ğŸ ','ğŸ¢','ğŸ¡','ğŸš—','âœˆï¸','ğŸ‘‘','ğŸ±','ğŸ¶','ğŸŒ¸','ğŸŒ¹'];
    let sortableInstance = null;

    // 1. í•­ëª© ì¶”ê°€
    function addItem() {
        const input = document.getElementById('todoInput');
        const text = input.value.trim();

        if (!text) return alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        if (items.length >= 9) return alert('ìµœëŒ€ 9ê°œê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆì–´ìš”!');

        items.push(text);
        input.value = '';
        renderList();
    }

    // 2. ëª©ë¡ ë Œë”ë§
    function renderList() {
        const listEl = document.getElementById('itemList');
        const btnEl = document.getElementById('makeBtn');

        listEl.innerHTML = '';

        items.forEach((item, index) => {
            const li = document.createElement('li');
            li.className = 'list-item';
            li.dataset.index = index;
            li.innerHTML = `
                <div style="display:flex; align-items:center; width:100%;">
                    <span style="margin-right:10px; cursor:grab;">â˜°</span>
                    <span class="count-badge">${index + 1}</span>
                    <span style="flex:1;">${item}</span>
                    <button class="delete-item" onclick="deleteItem(${index})">âœ–</button>
                </div>
            `;
            listEl.appendChild(li);
        });

        btnEl.disabled = items.length === 0;
        btnEl.innerText = `ğŸ¨ ë¹™ê³ íŒ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ í•˜ëŸ¬ê°€ê¸° (${items.length}/9)`;

        if (sortableInstance) sortableInstance.destroy();

        sortableInstance = new Sortable(listEl, {
            animation: 150,
            ghostClass: 'sortable-ghost',
            dragClass: 'sortable-drag',
            onEnd: function (evt) {
                const movedItem = items.splice(evt.oldIndex, 1)[0];
                items.splice(evt.newIndex, 0, movedItem);
                renderList();
            }
        });
    }

    function deleteItem(index) {
        items.splice(index, 1);
        renderList();
    }

    // 3. ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ í™”ë©´ìœ¼ë¡œ ì´ë™
    function goToCustomize() {
        if (items.length === 0) return alert('í•­ëª©ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”!');

        const grid = document.getElementById('customGrid');
        grid.innerHTML = '';

        // 9ì¹¸ ìƒì„±
        for (let i = 0; i < 9; i++) {
            let textValue = "";
            let emojiValue = EMOJI_LIST[Math.floor(Math.random() * EMOJI_LIST.length)];

            // ê°€ìš´ë°(4ë²ˆ, 5ë²ˆì§¸) ì¹¸ì€ ê¸°ë³¸ê°’ FREEë¡œ ì„¤ì •
            if (i === 4) {
                textValue = "FREE";
                emojiValue = "â¤ï¸";
            } else {
                // ë¦¬ìŠ¤íŠ¸ì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸° (ê°€ìš´ë°ë¥¼ ê±´ë„ˆë›°ë¯€ë¡œ ì¸ë±ìŠ¤ ì¡°ì •)
                const itemIndex = (i < 4) ? i : i - 1;
                if (items[itemIndex]) {
                    textValue = items[itemIndex];
                } else {
                    textValue = "";
                    emojiValue = "âœ¨";
                }
            }

            const cell = document.createElement('div');
            cell.className = 'custom-cell';
            cell.innerHTML = `
                <button class="custom-emoji-btn" onclick="cycleEmoji(this)">${emojiValue}</button>
                <input type="text" class="custom-input" value="${textValue}" placeholder="ë‚´ìš©">
            `;
            grid.appendChild(cell);
        }

        // í™”ë©´ ì „í™˜
        document.getElementById('inputSection').style.display = 'none';
        document.getElementById('customizeSection').style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ì´ëª¨í‹°ì½˜ ìˆœí™˜ ë³€ê²½
    function cycleEmoji(btn) {
        const currentEmoji = btn.innerText;
        let idx = EMOJI_LIST.indexOf(currentEmoji);
        if (idx === -1) idx = Math.floor(Math.random() * EMOJI_LIST.length);

        const nextIdx = (idx + 1) % EMOJI_LIST.length;
        btn.innerText = EMOJI_LIST[nextIdx];
    }

    // ëª©ë¡ í™”ë©´ìœ¼ë¡œ ë³µê·€
    function showInputList() {
        document.getElementById('customizeSection').style.display = 'none';
        document.getElementById('inputSection').style.display = 'block';
    }

    // 4. ìµœì¢… ë¹™ê³ íŒ ìƒì„±
    function generateFinalBingo() {
        const inputs = document.querySelectorAll('.custom-input');
        const emojis = document.querySelectorAll('.custom-emoji-btn');

 document.getElementBy        const table =Id('bingoTable');
        const cells = table.getElementsByTagName('td');

        for (let i = 0; i < 9; i++) {
            const text = inputs[i].value;
            const emoji = emojis[i].innerText;

            // ë¹ˆì¹¸ ì²˜ë¦¬
            if (!text) {
                cells[i].innerHTML = '<span class="cell-emoji">âœ¨</span><br>waiting';
                cells[i].classList.add('empty-cell');
            } else {
                cells[i].innerHTML = `<span class="cell-emoji">${emoji}</span>${text}`;
                cells[i].classList.remove('empty-cell');
            }
        }

        // í™”ë©´ ì „í™˜
        document.getElementById('customizeSection').style.display = 'none';
        document.getElementById('bingoWrapper').style.display = 'flex';
        document.getElementById('bingoWrapper').scrollIntoView({ behavior: 'smooth' });
    }

    // ìˆ˜ì •í•˜ê¸° ë²„íŠ¼
    function goBackToCustomize() {
        document.getElementById('bingoWrapper').style.display = 'none';
        document.getElementById('customizeSection').style.display = 'block';
    }

    // 5. ì´ë¯¸ì§€ ì €ì¥
    function downloadImage() {
        const captureArea = document.getElementById('captureArea');
        html2canvas(captureArea, {
            scale: 2,
            backgroundColor: '#ffffff',
            logging: false
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'love-bingo.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
    }

    // ì´ˆê¸°í™”
    renderList();

</script>
</body>
</html>