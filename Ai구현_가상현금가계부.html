<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’° ê°€ìƒ í˜„ê¸ˆ ì±Œë¦°ì§€</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --success: #00b894;
            --danger: #ff7675;
            --warning: #fdcb6e;
            --dark: #2d3436;
            --bg: #dfe6e9;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        /* í—¤ë” & ë ˆë²¨ */
        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .level-badge {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1rem;
        }

        .level-date {
            display: block;
            font-size: 0.8rem;
            margin-top: 5px;
            opacity: 0.9;
        }

        /* ì˜ˆì‚° ì„¤ì • */
        .budget-setup {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .budget-info h3 {
            font-size: 1rem;
            color: #888;
            margin-bottom: 5px;
        }

        .budget-info .amount {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--dark);
        }

        .budget-info .spent {
            font-size: 0.9rem;
            color: var(--danger);
        }

        .budget-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
        }

        /* ì§„í–‰ ë°” */
        .progress-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 15px;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--warning), var(--danger));
            border-radius: 10px;
            transition: width 0.5s;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #888;
        }

        /* í†µì¥ ëª©ë¡ */
        .accounts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .account-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .account-card:hover {
            transform: translateY(-5px);
        }

        .account-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .account-name {
            font-weight: 700;
        }

        .account-balance {
            font-size: 1.4rem;
            font-weight: 900;
            color: var(--primary);
        }

        .account-actions {
            display: flex;
            gap: 5px;
        }

        .btn-icon {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .progress-mini {
            height: 6px;
            background: #eee;
            border-radius: 3px;
            margin-top: 10px;
        }

        .progress-mini-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
        }

        .add-account-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: 3px dashed white;
            color: white;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .add-account-btn span {
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 25px;
            width: 100%;
            max-width: 400px;
        }

        .modal h2 {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 10px;
            font-size: 1rem;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-secondary {
            background: #eee;
            color: #555;
        }

        /* ê±°ë˜ ë‚´ì—­ */
        .transaction-list {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .transaction-amount.plus {
            color: var(--success);
        }

        .transaction-amount.minus {
            color: var(--danger);
        }
    </style>
</head>

<body>

    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <div class="level-badge">
                LV. <span id="levelNum">1</span> ğŸ’°
                <span class="level-date" id="levelDate">ê¸°ê°„ ì„¤ì • í•„ìš”</span>
            </div>
        </div>

        <!-- ì˜ˆì‚° ì„¤ì • -->
        <div class="budget-setup">
            <div class="budget-info">
                <h3>ì´ë²ˆ ë‹¬ ì˜ˆì‚°</h3>
                <div class="amount" id="totalBudget">â‚©0</div>
                <div class="spent">ëˆ„ì  ì§€ì¶œ: <span id="totalSpent">â‚©0</span></div>
            </div>
            <button class="budget-btn" onclick="openBudgetModal()">âš™ï¸ ì„¤ì •</button>
        </div>

        <!-- ì§„í–‰ë¥  -->
        <div class="progress-section">
            <div class="progress-header">
                <span>ì‚¬ìš©ë¥ </span>
                <span id="percentText">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="mainProgress" style="width: 0%"></div>
            </div>
            <div class="progress-stats">
                <span>ë‚¨ì€ ì˜ˆì‚°: <b id="budgetLeft">â‚©0</b></span>
                <span>ì ˆì•½ì•¡: <b id="budgetSaved">â‚©0</b></span>
            </div>
        </div>

        <!-- í†µì¥ ëª©ë¡ -->
        <div class="accounts-grid" id="accountsGrid">
            <div class="account-card add-account-btn" onclick="openModal('addAccount')">
                + <span>ìƒˆ í†µì¥ ì¶”ê°€</span>
            </div>
        </div>
    </div>

    <!-- ì˜ˆì‚° ì„¤ì • ëª¨ë‹¬ (ìˆ˜ì •ë¨) -->
    <div class="modal" id="budgetModal">
        <div class="modal-content">
            <h2>ğŸ“… ì˜ˆì‚° ê¸°ê°„ ì„¤ì •</h2>

            <div class="form-group">
                <label>ì‹œì‘ì¼</label>
                <input type="date" id="startDate">
            </div>

            <div class="form-group">
                <label>ì¢…ë£Œì¼</label>
                <input type="date" id="endDate">
            </div>

            <div class="form-group">
                <label>ì´ ì˜ˆì‚°</label>
                <input type="number" id="budgetInput" placeholder="ì˜ˆ: 1000000">
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="closeModal('budgetModal')">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveBudget()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- í†µì¥ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal" id="accountModal">
        <div class="modal-content">
            <h2 id="accountModalTitle">ìƒˆ í†µì¥ ë§Œë“¤ê¸°</h2>
            <div class="form-group">
                <label>í†µì¥ ì´ë¦„ (ëª©ì )</label>
                <input type="text" id="accountName" placeholder="ì˜ˆ: ì—¬í–‰ ìê¸ˆ">
            </div>
            <div class="form-group">
                <label>ëª©í‘œ ê¸ˆì•¡</label>
                <input type="number" id="accountGoal" placeholder="ì˜ˆ: 1000000">
            </div>
            <div class="form-group">
                <label>í˜„ì¬ ì”ì•¡</label>
                <input type="number" id="accountBalance" placeholder="ì˜ˆ: 0">
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="closeModal('accountModal')">ì·¨ì†Œ</button>
                <button class="btn btn-primary" id="saveAccountBtn">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- ê±°ë˜ ë‚´ì—­ ëª¨ë‹¬ -->
    <div class="modal" id="transactionModal">
        <div class="modal-content">
            <h2 id="transactionModalTitle">ê±°ë˜ ë‚´ì—­</h2>
            <div class="form-group">
                <label>ìœ í˜•</label>
                <select id="transactionType">
                    <option value="income">ìˆ˜ìµ (+) - ë„£ê¸°</option>
                    <option value="expense">ì§€ì¶œ (-) - ë¹¼ê¸°</option>
                </select>
            </div>
            <div class="form-group">
                <label>ë‚´ìš©</label>
                <input type="text" id="transactionTitle" placeholder="ì˜ˆ: ì›”ê¸‰, ì ì‹¬ê°’">
            </div>
            <div class="form-group">
                <label>ê¸ˆì•¡</label>
                <input type="number" id="transactionAmount" placeholder="ê¸ˆì•¡ ì…ë ¥">
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="closeModal('transactionModal')">ì·¨ì†Œ</button>
                <button class="btn btn-success" id="addTransactionBtn">ì¶”ê°€</button>
            </div>

            <hr style="margin: 20px 0; border: none; border-top: 1px solid #eee;">
            <div id="transactionList"></div>
        </div>
    </div>

    <!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
    <div class="modal" id="deleteModal">
        <div class="modal-content" style="text-align: center;">
            <h2>ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h2>
            <p style="margin: 15px 0; color: #666;">ì´ í†µì¥ì˜ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.</p>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="closeModal('deleteModal')">ì·¨ì†Œ</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">ì‚­ì œ</button>
            </div>
        </div>
    </div>

    <script>
        // ë°ì´í„° ì €ì¥ì†Œ
        let budgetSettings = JSON.parse(localStorage.getItem('budgetSettings')) || {
            startDate: '',
            endDate: '',
            totalBudget: 0
        };
        let accounts = JSON.parse(localStorage.getItem('cashChallengeAccounts')) || [];
        let currentAccountId = null;
        let deleteTarget = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', () => {
            renderAll();
        });

        function renderAll() {
            renderBudget();
            renderAccounts();
        }

        // ========== ì˜ˆì‚° ë Œë”ë§ ==========
        function renderBudget() {
            const { startDate, endDate, totalBudget } = budgetSettings;

            // ê¸°ê°„ í‘œì‹œ
            const levelDate = document.getElementById('levelDate');
            if (startDate && endDate) {
                const start = startDate.split('-').slice(1).join('.');
                const end = endDate.split('-').slice(1).join('.');
                levelDate.innerText = `${start} ~ ${end}`;
            } else {
                levelDate.innerText = 'ê¸°ê°„ ì„¤ì • í•„ìš”';
            }

            // ì „ì²´ ëˆ„ì  ì§€ì¶œ ê³„ì‚°
            let totalSpent = 0;
            accounts.forEach(acc => {
                acc.transactions?.forEach(t => {
                    if (t.type === 'expense') totalSpent += t.amount;
                });
            });

            const left = totalBudget - totalSpent;
            const saved = Math.max(0, left);
            const percent = totalBudget > 0 ? Math.min((totalSpent / totalBudget) * 100, 100) : 0;

            document.getElementById('totalBudget').innerText = `â‚©${totalBudget.toLocaleString()}`;
            document.getElementById('totalSpent').innerText = `â‚©${totalSpent.toLocaleString()}`;
            document.getElementById('budgetLeft').innerText = `â‚©${left.toLocaleString()}`;
            document.getElementById('budgetSaved').innerText = `â‚©${saved.toLocaleString()}`;
            document.getElementById('percentText').innerText = `${Math.round(percent)}%`;

            const progress = document.getElementById('mainProgress');
            progress.style.width = `${percent}%`;

            // ìƒ‰ìƒ ë³€ê²½
            if (percent > 90) progress.style.background = '#ff7675';
            else if (percent > 70) progress.style.background = '#fdcb6e';
            else progress.style.background = 'linear-gradient(90deg, #00b894, #fdcb6e)';

            // ë ˆë²¨ ê³„ì‚°
            const level = Math.floor(totalBudget / 100000) + 1;
            document.getElementById('levelNum').innerText = level;

            saveData();
        }

        // ========== í†µì¥ ë Œë”ë§ ==========
        function renderAccounts() {
            const grid = document.getElementById('accountsGrid');
            const cards = grid.querySelectorAll('.account-card:not(.add-account-btn)');
            cards.forEach(card => card.remove());

            accounts.forEach(account => {
                const card = document.createElement('div');
                card.className = 'account-card';
                card.onclick = (e) => {
                    if (!e.target.closest('.account-actions')) {
                        openTransactionModal(account.id);
                    }
                };

                const progress = Math.min((account.balance / account.goal) * 100, 100);
                let barColor = 'var(--primary)';
                if (progress >= 100) barColor = 'var(--danger)';
                else if (progress >= 70) barColor = 'var(--warning)';

                card.innerHTML = `
                <div class="account-header">
                    <span class="account-name">${account.name}</span>
                    <div class="account-actions">
                        <button class="btn-icon btn-secondary" onclick="editAccount(${account.id})">âœï¸</button>
                        <button class="btn-icon" style="background:#ffecec; color:var(--danger)" onclick="confirmDelete(${account.id})">ğŸ—‘ï¸</button>
                    </div>
                </div>
                <div class="account-balance">â‚©${account.balance.toLocaleString()}</div>
                <div style="font-size: 0.8rem; color: #888; margin-top: 5px;">ëª©í‘œ: â‚©${account.goal.toLocaleString()}</div>
                <div class="progress-mini">
                    <div class="progress-mini-fill" style="width: ${progress}%; background: ${barColor}"></div>
                </div>
            `;

                grid.insertBefore(card, grid.lastElementChild);
            });
        }

        // ========== ì˜ˆì‚° ==========
        function openBudgetModal() {
            document.getElementById('startDate').value = budgetSettings.startDate || '';
            document.getElementById('endDate').value = budgetSettings.endDate || '';
            document.getElementById('budgetInput').value = budgetSettings.totalBudget || '';
            document.getElementById('budgetModal').classList.add('show');
        }

        function saveBudget() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const amount = parseInt(document.getElementById('budgetInput').value) || 0;

            if (!startDate || !endDate) {
                alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }

            if (startDate > endDate) {
                alert('ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ë³´ë‹¤ ë¹ ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }

            budgetSettings.startDate = startDate;
            budgetSettings.endDate = endDate;
            budgetSettings.totalBudget = amount;

            saveData();
            closeModal('budgetModal');
            renderBudget();
        }

        // ========== í†µì¥ CRUD ==========
        function openModal(type) {
            if (type === 'addAccount') {
                document.getElementById('accountModalTitle').innerText = 'ìƒˆ í†µì¥ ë§Œë“¤ê¸°';
                document.getElementById('accountName').value = '';
                document.getElementById('accountGoal').value = '';
                document.getElementById('accountBalance').value = '0';
                document.getElementById('saveAccountBtn').onclick = saveNewAccount;
            }
            document.getElementById(type === 'addAccount' ? 'accountModal' : 'transactionModal').classList.add('show');
        }

        function saveNewAccount() {
            const name = document.getElementById('accountName').value;
            const goal = parseInt(document.getElementById('accountGoal').value) || 0;
            const balance = parseInt(document.getElementById('accountBalance').value) || 0;

            if (!name) { alert('í†µì¥ ì´ë¦„ì„ ì…ë ¥!'); return; }

            const newAccount = {
                id: Date.now(),
                name: name,
                goal: goal,
                balance: balance,
                transactions: []
            };

            accounts.push(newAccount);
            closeModal('accountModal');
            renderAccounts();
        }

        function editAccount(id) {
            const account = accounts.find(a => a.id === id);
            if (!account) return;

            document.getElementById('accountModalTitle').innerText = 'í†µì¥ ìˆ˜ì •';
            document.getElementById('accountName').value = account.name;
            document.getElementById('accountGoal').value = account.goal;
            document.getElementById('accountBalance').value = account.balance;

            document.getElementById('saveAccountBtn').onclick = () => {
                account.name = document.getElementById('accountName').value;
                account.goal = parseInt(document.getElementById('accountGoal').value) || 0;
                account.balance = parseInt(document.getElementById('accountBalance').value) || 0;

                closeModal('accountModal');
                renderAccounts();
            };

            document.getElementById('accountModal').classList.add('show');
        }

        function confirmDelete(id) {
            deleteTarget = id;
            document.getElementById('deleteModal').classList.add('show');

            document.getElementById('confirmDeleteBtn').onclick = () => {
                accounts = accounts.filter(a => a.id !== deleteTarget);
                closeModal('deleteModal');
                renderAccounts();
            };
        }

        // ========== ê±°ë˜ ë‚´ì—­ ==========
        function openTransactionModal(id) {
            currentAccountId = id;
            const account = accounts.find(a => a.id === id);

            document.getElementById('transactionModalTitle').innerText = account.name;
            document.getElementById('transactionType').value = 'income';
            document.getElementById('transactionTitle').value = '';
            document.getElementById('transactionAmount').value = '';

            renderTransactions(account);
            document.getElementById('transactionModal').classList.add('show');
        }

        function renderTransactions(account) {
            const list = document.getElementById('transactionList');

            if (!account.transactions || account.transactions.length === 0) {
                list.innerHTML = '<div style="text-align:center; color:#888; padding:20px;">ê±°ë˜ ë‚´ì—­ ì—†ìŒ</div>';
                return;
            }

            list.innerHTML = account.transactions.map(t => `
            <div class="transaction-item">
                <div>
                    <div style="font-weight:500">${t.title}</div>
                    <div style="font-size:0.8rem; color:#888">${new Date(t.date).toLocaleDateString()}</div>
                </div>
                <div class="transaction-amount ${t.type === 'income' ? 'plus' : 'minus'}">
                    ${t.type === 'income' ? '+' : '-'}â‚©${t.amount.toLocaleString()}
                    <button onclick="deleteTransaction(${t.id})" style="margin-left:10px; border:none; background:none; cursor:pointer; color:#888;">Ã—</button>
                </div>
            </div>
        `).join('');
        }

        document.getElementById('addTransactionBtn').addEventListener('click', () => {
            const type = document.getElementById('transactionType').value;
            const title = document.getElementById('transactionTitle').value;
            const amount = parseInt(document.getElementById('transactionAmount').value);

            if (!title || !amount) { alert('ë‚´ìš©ê³¼ ê¸ˆì•¡ ì…ë ¥!'); return; }

            const account = accounts.find(a => a.id === currentAccountId);

            if (type === 'income') account.balance += amount;
            else account.balance -= amount;

            account.transactions.push({
                id: Date.now(),
                type: type,
                title: title,
                amount: amount,
                date: new Date().toISOString()
            });

            document.getElementById('transactionTitle').value = '';
            document.getElementById('transactionAmount').value = '';

            renderTransactions(account);
            renderAccounts();
            renderBudget();
        });

        function deleteTransaction(tId) {
            const account = accounts.find(a => a.id === currentAccountId);
            const t = account.transactions.find(tr => tr.id === tId);

            if (t.type === 'income') account.balance -= t.amount;
            else account.balance += t.amount;

            account.transactions = account.transactions.filter(tr => tr.id !== tId);

            renderTransactions(account);
            renderAccounts();
            renderBudget();
        }

        // ========== ìœ í‹¸ ==========
        function closeModal(id) { document.getElementById(id).classList.remove('show'); }
        function saveData() {
            localStorage.setItem('budgetSettings', JSON.stringify(budgetSettings));
            localStorage.setItem('cashChallengeAccounts', JSON.stringify(accounts));
        }

        window.onclick = (e) => {
            if (e.target.classList.contains('modal')) e.target.classList.remove('show');
        };
    </script>

</body>

</html>